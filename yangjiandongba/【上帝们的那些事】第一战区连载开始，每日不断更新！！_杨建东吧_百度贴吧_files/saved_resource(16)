_.Module.define({path:"pb/widget/PbTrack",sub:{initial:function(){try{var t=this;$(".j_benba_search").click(function(){try{t._sendTrack("\u5427\u5185\u641C\u7D22\u70B9\u51FB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:7}),e}}),$(".j_search_post").click(function(){try{t._sendTrack("\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:8}),e}}),$(".share_thread").mouseover(function(){t._sendTrack("PB\u4E00\u697C\u5206\u4EAB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),$(".p_sharebar").mouseover(function(){t._sendTrack("PB\u5E95\u90E8\u5206\u4EAB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")});var e=setInterval(function(){$(".tbui_fbar_share").length&&($(".tbui_fbar_share").mouseover(function(){t._sendTrack("PB\u5DE6\u4FA7\u5206\u4EAB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),clearInterval(e))},200);$("#tofrs_up").click(function(){try{t._sendTrack("PB\u9875\u8FD4\u56DEFRS\u94FE\u63A5-\u9875\u9996","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:17}),e}}),$("#tofrs_down").click(function(){try{t._sendTrack("PB\u9875\u8FD4\u56DEFRS\u94FE\u63A5-\u9875\u5C3E","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:18}),e}}),$(".tab_forumname").click(function(){try{t._sendTrack("PB\u9875\u8FD4\u56DEFRS\u4E3B\u9875\u6309\u94AE","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:19}),e}});var c=setInterval(function(){$(".j_lzl_p_sv").length&&($(".j_lzl_p_sv").click(function(){try{t._sendTrack("\u697C\u4E2D\u697C\u8BED\u97F3\u6309\u94AE","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:22}),e}}),clearInterval(c))},200),a=setInterval(function(){$(".edui-btn-voice").length&&($(".edui-btn-voice").click(function(){try{t._sendTrack("\u56DE\u590D\u6846\u8BED\u97F3\u6309\u94AE","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:28}),e}}),clearInterval(a))},200);$(".v2_tab a").eq(3).click(function(){try{t._sendTrack("PB\u9875\u7CBE\u54C1\u6807\u7B7E","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:32}),e}}),$(".sign_title_text_bright a").click(function(){try{t._sendTrack("\u7B7E\u5230\u6846\u4E0A\u4E0B\u7684\u5BA2\u6237\u7AEF\u63A8\u5E7F\u94FE\u63A5","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:33}),e}})}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:35}),n}},_sendTrack:function(t,e,c){$.stats.track(t,e,c,"click")}}});_.Module.define({path:"common/widget/umoney_promotion_dialog",sub:{storageKey:"Umoney_Promotion",$wrap:null,initial:function(o){var n=this;o=o||{},n.option=o,n.showCount=o.showCount||"1",n.userId=o.userId||$.getPageData("user.id",""),n.promotionUrl=o.promotionUrl||"",""!==n.userId&&(n.key=this.storageKey+"_"+this.userId,n.isOpened()||(n.showDialog(),n.bindEvents(),n.setOpened()))},showDialog:function(){var o=this,n='<div class="umoney-dialog">\r\n    <a class="close-bg"><span class="close-btn"></span></a>\r\n\r\n</div>',t="umoney-promotion-dialog";if(!($("."+t).length>0)){var e={modal:!0,showTitle:!1,fixed:!0,width:485,height:358,holderClassName:t,draggable:!0,html:n},i=$.dialog;o._dialog=new i(e),o._dialog.show(),o.$wrap=o._dialog.element,o.$wrap.find(".umoney-dialog").css({background:"url("+o.option.backgroundImageUrl+") no-repeat"}),o.track("show")}},bindEvents:function(){var o=this;this.$wrap.on("click",".umoney-dialog",function(n){o.stopEvent(n),window.open(o.promotionUrl),o.track("open-umoney"),o.closeDialog()}).on("click",".close-btn",function(n){o.stopEvent(n),o.closeDialog()})},closeDialog:function(){var o=this;o._dialog&&o._dialog.close(),o.track("close")},isOpened:function(){var o=this,n=$.tb.Storage.get(o.key);return n===o.showCount||""===n},setOpened:function(){var o=this;$.tb.Storage.set(o.key,o.showCount)},stopEvent:function(o){o.preventDefault(),o.stopPropagation()},track:function(o,n){$.stats.track(o,"umoney-promotion",PageData.product+"-"+n,"click")}}});_.Module.define({path:"common/widget/advertiseRight",requires:[],sub:{initial:function(){var e=$.tb.Storage.get("oldtime"),t=(new Date).getTime();t-e>864e5&&$(".advertise_right_index").css("display","block"),this.bindEvents()},bindEvents:function(){$(".adv_close_button").click(function(){$(".advertise_right_index").css("display","none"),$.tb.Storage.set("oldtime",1*new Date)})}}});_.Module.define({path:"tbmall/widget/grab_treasure_dialog_success",sub:{initial:function(s){this.opts=s,this.data=this.opts.diamondData||{},this.data.issue&&this.showDialog(this.data)},showDialog:function(s){var a='<div class="grab-treasure-dialog-success-main">     <div class="title">\u606D\u559C\u60A8\u593A\u5B9D\u6210\u529F</div>     <div class="detail">         <div class="issue-num">\u7B2C<%=issue%>\u671F</div>         <div class="goods-name"><%=goods_name%></div>     </div>     <a target="_blank" href="<%=url%>" class="address-btn"></a> </div> ',i=_.template(a)(s),t=new $.dialog({html:i,title:"\u593A\u5B9D\u89C4\u5219",showShadow:!1,showTitle:!1,holderClassName:"grab-treasure-dialog-success",width:600});t.element.find(".address-btn").on("click",function(){$.ajax({url:"/diamondmall/post/clearNotification?tbs="+PageData.tbs}).done(function(s){console.log(s)}),t.close()})}}});_.Module.define({path:"frs/widget/forum_card/focus_btn",requires:["comforum/widget/attentionCategoryGame"],sub:{initial:function(t){try{this.isOfficial=t.isOfficial,this.tbs=t.tbs,this.uid=t.uid,this.is_forum_fourth_manager=t.is_forum_fourth_manager,this.avatar=t.avatar,this.userForumList=t.userForumList||"",this.forum_name="",t.fr&&"bawu"==t.fr&&(this.forum_name=$.tb.unescapeHTML(t.forum_name));var e=this,a=$("#j_head_focus_btn"),o=null;e.config={},e.config.url={closetip:"/f/like/commit/notice/delete",dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete"},o=parseInt(t.islike)?function(){if(PageData.user.power&&PageData.user.power.bawu)return e._showAlert('<p style="text-align: center;">\u60A8\u8FD8\u662F\u672C\u5427\u7684\u5427\u52A1\uFF0C\u8F9E\u804C\u540E\u624D\u80FD\u53D6\u6D88\u5173\u6CE8\u54E6~</p>'),!1;var t=PageData.forum_name||PageData.forum.forum_name;t=$.tb.subByte(t,10,"...");var a=['<div style="width:190px;text-align:center;top:18px;left:10px;position:absolute;">\u786E\u5B9A\u4E0D\u518D\u5173\u6CE8 <span style="color:red">'+t+"</span> \u5427\uFF1F</div>",'<a href="#" id="cancel_focus_yes" class=" ui_btn ui_btn_s" style="position:absolute;top:50px;left:55px;">',"<span><em>\u786E\u8BA4</em></span>","</a>",'<a href="#" onclick="return false;" id="cancel_focus_no" class="ui_btn ui_btn_sub_s" style="position:absolute;top:50px;left:105px;">',"<span><em>\u53D6\u6D88</em></span>","</a>"].join(""),o=new $.dialog({html:a,showTitle:!1,fixed:!1,show:!0,draggable:!1,autoCenter:!1,modal:!1,top:$("#j_head_focus_btn").offset().top-$(this).height()/2-90,left:$("#j_head_focus_btn").offset().left-$(this).width()/2+15,width:210,height:70});$("#cancel_focus_yes").on("click",function(){try{e._undolike(),o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:82}),t}}),$("#cancel_focus_no").on("click",function(){try{o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:85}),t}})}:function(){e._dolike()},a.on("click",o),$(".j_search_post ").click(function(){try{$.stats.track("FRS\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:95}),t}}),$(".search_internal_btn").click(function(){try{$.stats.track("FRS\u5427\u5185\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:98}),t}}),$(".sign_title_text_bright").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:101}),t}}),$(".j_nav_list > li:eq(2) a").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:104}),t}})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:105}),i}},_showAlert:function(t){var e='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+t+"</div>";$.dialog.open(e,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},_dolike:function(){var t=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.is_login&&PageData.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u559C\u6B22\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var e={};1==$.tb.location.getSearchValue("fromadlike")&&$.stats.track("\u95F4\u63A5\u52A0\u5173\u6CE8","\u5206\u53D1\u5173\u6CE8\u5427\u63A8\u8350","","click"),PageData.forum&&(e={fid:PageData.forum.id||PageData.forum.forum_id,fname:t.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.post(t.config.url.dolike,e,function(e){var a=!1;try{var o=e}catch(i){a=!0}if(!a)if(o&&0==o.no)Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikesucc&bduid="+PageData.user.bduid),t.isOfficial?_.Module.use("frs/widget/platform_attention_recommend",[{tbs:t.tbs,uid:t.uid,is_forum_fourth_manager:t.is_forum_fourth_manager,avatar:t.avatar}]):"\u6E38\u620F"==PageData.forum.first_class?_.Module.use("comforum/widget/attentionCategoryGame",["",!1,{index:o.data.ret.index,like_no:o.like_no}]):_.Module.use("ucenter/widget/LikeTip",["",!1,{index:o.data.ret.index,like_no:o.like_no},t.userForumList]),$.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=auto");else{Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikefail&errorno="+o.no);var s="";s=8==o.no||9==o.no?"\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":220==o.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==o.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",t._showAlert(s)}},"json")},_undolike:function(){var t=this,e=null;PageData.forum&&(e={fid:PageData.forum.forum_id,fname:t.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.tb.post(t.config.url.undolike,e,function(t){var e=!1;try{var a=t}catch(o){e=!0}e||a&&0==a.no&&$.tb.location.reload(!0)})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"encourage/widget/npc_vote/npc_vote_action",sub:{initial:function(e){this._opt=e,this._bindEvents()},_bindEvents:function(){var e=this,t=this._opt.$root;t.on("click",".j-btn-vote",function(){if(!PageData.user.is_login)return e.requireInstanceAsync("common/widget/LoginDialog"),void 0;var a=$(this).data("id"),n=$(this).data("forumname");$.post("/celebrity/submit/voteNpc",{tbs:PageData.tbs,id:a},function(a){switch(a.no){case 0:t.find(".j_vote_npc_"+a.data.id).find(".j_vote_num").text(a.data.vote_num),e._success();break;case 952710:e._attention(n);break;case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:e._alert({msg:"\u5427\u7B49\u7EA7\u8FBE\u5230"+(a.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6"});break;case 952712:e._alert({msg:"\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~"});break;case 952713:e._alert({msg:"\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5373\u5C06\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85"});break;case 952709:e._alert({msg:"\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B"});break;case 65534:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5"});break;case 65533:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301"});break;case 65532:e._alert({msg:"IP\u4E00\u5929\u8D85\u8FC7500"});break;default:$.dialog.alert(a.error,{title:"\u63D0\u793A"})}})})},_success:function(){var e='<div class="npc-vote-dialog"><p>\u6295\u7968\u6210\u529F</p><div class="btn-group"><a href="/celebrity/rankHome#npc_vote" class="btn-default btn-small mr10 j-see-rank">\u67E5\u770B\u699C\u5355</a> <a href="javascript:;" class="btn-sub btn-small j_close">\u53D6 \u6D88</a></div></div>',t=this._alert({html:e});$(t.element).find(".j-see-rank").on("click",function(){t.close()})},_alert:function(e){var t=e.html||'<div class="npc-vote-dialog"><p>'+e.msg+'</p><div class="btn-group">  <a href="#" class="btn-default btn-small j_close">\u786E \u8BA4</a></div></div>',a=new $.dialog({width:380,html:t,title:"\u63D0\u793A",draggable:!1});return $(a.element).find(".j_close").on("click",function(){return a.close(),!1}),a},_attention:function(e){var t='<div class="npc-vote-dialog"><p>\u672A\u5173\u6CE8\u672C\u5427\u4E0D\u80FD\u6295\u7968\u54E6~</p><div class="btn-group"> <a href="/f?kw='+encodeURIComponent(e)+'" class="btn-default btn-small">\u53BB\u5173\u6CE8</a></div></div>';new $.dialog({width:350,html:t,title:"\u63D0\u793A",draggable:!1})}}});_.Module.define({path:"frs/widget/forum_card/focus_btn",requires:["comforum/widget/attentionCategoryGame"],sub:{initial:function(t){try{this.isOfficial=t.isOfficial,this.tbs=t.tbs,this.uid=t.uid,this.is_forum_fourth_manager=t.is_forum_fourth_manager,this.avatar=t.avatar,this.userForumList=t.userForumList||"",this.forum_name="",t.fr&&"bawu"==t.fr&&(this.forum_name=$.tb.unescapeHTML(t.forum_name));var e=this,a=$("#j_head_focus_btn"),o=null;e.config={},e.config.url={closetip:"/f/like/commit/notice/delete",dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete"},o=parseInt(t.islike)?function(){if(PageData.user.power&&PageData.user.power.bawu)return e._showAlert('<p style="text-align: center;">\u60A8\u8FD8\u662F\u672C\u5427\u7684\u5427\u52A1\uFF0C\u8F9E\u804C\u540E\u624D\u80FD\u53D6\u6D88\u5173\u6CE8\u54E6~</p>'),!1;var t=PageData.forum_name||PageData.forum.forum_name;t=$.tb.subByte(t,10,"...");var a=['<div style="width:190px;text-align:center;top:18px;left:10px;position:absolute;">\u786E\u5B9A\u4E0D\u518D\u5173\u6CE8 <span style="color:red">'+t+"</span> \u5427\uFF1F</div>",'<a href="#" id="cancel_focus_yes" class=" ui_btn ui_btn_s" style="position:absolute;top:50px;left:55px;">',"<span><em>\u786E\u8BA4</em></span>","</a>",'<a href="#" onclick="return false;" id="cancel_focus_no" class="ui_btn ui_btn_sub_s" style="position:absolute;top:50px;left:105px;">',"<span><em>\u53D6\u6D88</em></span>","</a>"].join(""),o=new $.dialog({html:a,showTitle:!1,fixed:!1,show:!0,draggable:!1,autoCenter:!1,modal:!1,top:$("#j_head_focus_btn").offset().top-$(this).height()/2-90,left:$("#j_head_focus_btn").offset().left-$(this).width()/2+15,width:210,height:70});$("#cancel_focus_yes").on("click",function(){try{e._undolike(),o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:82}),t}}),$("#cancel_focus_no").on("click",function(){try{o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:85}),t}})}:function(){e._dolike()},a.on("click",o),$(".j_search_post ").click(function(){try{$.stats.track("FRS\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:95}),t}}),$(".search_internal_btn").click(function(){try{$.stats.track("FRS\u5427\u5185\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:98}),t}}),$(".sign_title_text_bright").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:101}),t}}),$(".j_nav_list > li:eq(2) a").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:104}),t}})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:105}),i}},_showAlert:function(t){var e='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+t+"</div>";$.dialog.open(e,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},_dolike:function(){var t=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.is_login&&PageData.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u559C\u6B22\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var e={};1==$.tb.location.getSearchValue("fromadlike")&&$.stats.track("\u95F4\u63A5\u52A0\u5173\u6CE8","\u5206\u53D1\u5173\u6CE8\u5427\u63A8\u8350","","click"),PageData.forum&&(e={fid:PageData.forum.id||PageData.forum.forum_id,fname:t.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.post(t.config.url.dolike,e,function(e){var a=!1;try{var o=e}catch(i){a=!0}if(!a)if(o&&0==o.no)Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikesucc&bduid="+PageData.user.bduid),t.isOfficial?_.Module.use("frs/widget/platform_attention_recommend",[{tbs:t.tbs,uid:t.uid,is_forum_fourth_manager:t.is_forum_fourth_manager,avatar:t.avatar}]):"\u6E38\u620F"==PageData.forum.first_class?_.Module.use("comforum/widget/attentionCategoryGame",["",!1,{index:o.data.ret.index,like_no:o.like_no}]):_.Module.use("ucenter/widget/LikeTip",["",!1,{index:o.data.ret.index,like_no:o.like_no},t.userForumList]),$.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=auto");else{Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikefail&errorno="+o.no);var s="";s=8==o.no||9==o.no?"\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":220==o.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==o.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",t._showAlert(s)}},"json")},_undolike:function(){var t=this,e=null;PageData.forum&&(e={fid:PageData.forum.forum_id,fname:t.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.tb.post(t.config.url.undolike,e,function(t){var e=!1;try{var a=t}catch(o){e=!0}e||a&&0==a.no&&$.tb.location.reload(!0)})}}});_.Module.define({path:"adsense/widget/tpl_5",requires:[],sub:{initial:function(e){var n=this;this.requireInstanceAsync("adsense/widget/loader",[],function(s){s.loadAD(e,n.extraParam,$.proxy(n.customFn,n))})},customFn:function(){"pass"}}});_.Module.define({path:"pb/widget/recommendPhotoNew",sub:{_slideShow:null,_slideConfig:{nav:".exchange",target:".thread_list_slideshow",activeClass:"current",interval:5e3,auto:!1,next:"",prev:"",delayLoadPic:!0,slide:{speed:500}},_wrap:$(".thread_recommend"),track_task:"pb\u5185\u5BB9\u63A8\u8350",initial:function(t){try{var e=this;e.args=t,e._bindEvents(),e._slideShow=e.use("common/component/SlideShow",e._slideConfig)}catch(o){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message||o.description,path:"pb:widget/recommend_photo_new/recommend_photo_new.js",method:"",ln:33}),o}},_bindEvents:function(){var t=this;t._itrack()},_itrack:function(){var t=this;t._track_text_show(),t._track_img_click(),t._track_text_click(),t._track_change_click()},_track_text_show:function(){var t=this,e="";return t._wrap.find(".tiezi_recommend .recommend_container:first a").each(function(){0==$(this).parent("li").index()?e+=$(this).tbattr("data-tid"):e=e+"_"+$(this).tbattr("data-tid")}),""==e?!1:($.stats.track("related",t.track_task,"pb","show",{obj_id:e,obj_type:t.args.model_id,obj_query:t.args.mes}),void 0)},_track_img_click:function(){try{var t=this;t._wrap.on("click",".portrait",function(){try{var e=$(this).parent("li").index()+1,o=$(this).parent("a").tbattr("data-tid");$.stats.track("related_portrait",t.track_task,"pb","click",{obj_id:o,obj_type:t.args.model_id,obj_query:t.args.mes,rank:e})}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/recommend_photo_new/recommend_photo_new.js",method:"",ln:80}),a}})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/recommend_photo_new/recommend_photo_new.js",method:"",ln:82}),e}},_track_text_click:function(){try{var t=this;t._wrap.on("click",".tiezi_recommend .recommend_container a",function(){try{var e=$(this).parent("li").index()+1,o=$(this).tbattr("data-tid");$.stats.track("related",t.track_task,"pb","click",{obj_id:o,obj_type:t.args.model_id,obj_query:t.args.mes,rank:e})}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/recommend_photo_new/recommend_photo_new.js",method:"",ln:96}),a}})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/recommend_photo_new/recommend_photo_new.js",method:"",ln:97}),e}},_track_change_click:function(){try{var t=this;$(".thread_recommend .tiezi_recommend .recommend_container").length>=2&&t._wrap.find(".slide_thread_container").on("click","a",function(e){try{var o="",a=$(e.target).tbattr("data-index");setTimeout(function(){$(e.target).closest(".thread_recommend").find(".tiezi_recommend .current li a").each(function(){0==$(this).parent("li").index()?o+=$(this).tbattr("data-tid"):o=o+"_"+$(this).tbattr("data-tid")}),$.stats.track("related",t.track_task,"pb","show",{nav_index:a,obj_id:o,obj_type:t.args.model_id,obj_query:t.args.mes})},100)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/recommend_photo_new/recommend_photo_new.js",method:"",ln:123}),e}})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/recommend_photo_new/recommend_photo_new.js",method:"",ln:125}),e}}}});_.Module.define({path:"pb/widget/threadRecommend",requires:["common/component/SlideShow"],sub:{_slideConfig:{target:"#recom_scroll_list .recom_scroll_wrap",nav:"#recom_scroll_list .recom_scroll_navs",interval:5e3,prev:"#recom_scroll_list .recom_scrol_ctrl_l",next:"#recom_scroll_list .recom_scrol_ctrl_r",slide:{speed:400}},initial:function(t){try{this.args=t,t.total>2?(this.slideShow=this.requireInstance("common/component/SlideShow",this._slideConfig),$("#recom_scroll_list .recom_scrol_ctrls").show()):($(".recom_boxes").show(),$(".recom_scroll_ctrls").hide()),this.has_related=this.args.has_related,this.tids=this.args.tids.join("_"),this.model_id=this.args.model_id,this.ps_query=this.args.ps_query,this.col_related_name="related",this.track_task="pb\u5185\u5BB9\u63A8\u8350",$.stats.track("\u6A21\u5757\u6574\u4F53\u5C55\u793A\u91CF",this.track_task,"pb","show",{obj_id:this.has_related?this.tids:"",obj_type:this.has_related?this.model_id:"",obj_query:this.has_related?this.ps_query:""}),$.stats.track("\u7B2C1\u9875\u6A21\u5757\u5C55\u793A\u91CF",this.track_task,"pb","show",{obj_id:this.has_related?this.tids:"",obj_type:this.has_related?this.model_id:"",obj_query:this.has_related?this.ps_query:""}),this.ps_query&&$.stats.track("query",this.track_task,"pb","show",{obj_id:this.tids,obj_type:this.model_id,obj_query:this.ps_query}),this.bindEvents()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/thread_recommend/thread_recommend.js",method:"",ln:61}),e}},bindEvents:function(){var t=this;$(".thread_recommend [data-locate]").delegate("a","click",function(){try{var e=$(this).closest("[data-locate]").data("locate"),s=$(this).data("tid");$.stats.track(e,t.track_task,{obj_id:s,obj_type:e==t.col_related_name?t.model_id:"",obj_query:e==t.col_related_name?t.ps_query:""})}catch(r){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:r.message||r.description,path:"pb:widget/thread_recommend/thread_recommend.js",method:"",ln:74}),r}}),$(".thread_recommend .recom_scrol_ctrl").on("click",function(){try{var e=$(this).data("locate");$.stats.track(e,t.track_task,"pb");var s=t.slideShow.current;s="\u4E0B\u4E00\u4E2A"==e?++s>=t.slideShow.total?0:s:--s<0?t.slideShow.total-1:s;var r="\u7B2C"+(s+1)+"\u9875\u6A21\u5757\u5C55\u793A\u91CF",o=t.has_related&&0==s;$.stats.track(r,t.track_task,"pb","show",{obj_id:o?t.tids:"",obj_type:o?t.model_id:"",obj_query:o?t.ps_query:""})}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/thread_recommend/thread_recommend.js",method:"",ln:96}),a}}),$(".thread_recommend .thread_recommend_query a").on("click",function(){try{$.stats.track("query",t.track_task,{obj_id:t.tids,obj_type:t.model_id,obj_query:t.ps_query})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/thread_recommend/thread_recommend.js",method:"",ln:105}),e}})}}});_.Module.define({path:"comforum/widget/AdPost",sub:{initial:function(){}}});_.Module.define({path:"encourage/widget/novel_ranking",requires:["encourage/widget/novel_icons","encourage/widget/novel_award_dialog","common/widget/image_uploader_manager"],sub:{initial:function(n){this.opt=n||{curMonth:(new Date).getMonth()+1,curYear:(new Date).getFullYear(),forumId:0},this.$rootDom=$("#novel-ranking"),this.$asideAwardDom=$(".novel-award-aside-area"),this.novelIcons=this.requireInstance("encourage/widget/novel_icons",[]),this.awardDialog=this.requireInstance("encourage/widget/novel_award_dialog",[this.opt]),this.initRanking(),this.bindEvents()},bindEvents:function(){var n=this;this.$rootDom.on("mouseenter",".novel-rank-top-nav td",function(){var a=$(this);if(a.hasClass("active"))return!1;a.parent().find("td").removeClass("active"),a.addClass("active"),n.$rootDom.find(".novel-rank-list").hide(),n.$rootDom.find(".j-novel-rank-list-"+a.tbattr("data-type")).show(),n.$rootDom.find(".novel-rank-extra").hide(),n.$rootDom.find(".j-novel-rank-extra-"+a.tbattr("data-type")).show();var e=n.$rootDom.find(".j-novel-ranking-frs-last-"+a.tbattr("data-type"));e.length>0&&(n.$rootDom.find(".novel-ranking-frs-last").hide(),e.show())}).on("mouseenter",".novel-ranking-item",function(){var n=$(this);return n.hasClass("active")?!1:(n.parent().find(".novel-ranking-item").removeClass("active"),n.addClass("active"),void 0)}),this.$rootDom.find(".novel-rank-top-nav td").eq(0).trigger("mouseenter"),this.$asideAwardDom.on("click",".novel-award-aside-btn",function(){n.awardDialog.show(n.opt)})},initRanking:function(){var n=this,a=this.$rootDom.find(".novel-ranking-last-area");this.getMonthlyTicketRanking(10,function(e){var t=e.novel_info;t&&(n.opt.novelName=t.novel_name,t.month_ticket=n.novelIcons.getMonthlyTicketIcon()+'<span class="novel-award-aside-tdou-number">'+t.month_ticket+"</span>",n.$asideAwardDom.html(_.template('<div class="novel-award-aside">     <div class="novel-award-aside-title">         \u672C\u4F5C\u54C1\u5427         <% if(editable > 0){ %><a href="javascript:;" class="novel-award-aside-edit">[\u7F16\u8F91]</a><% } %>         <a href="/novel/fans?forum_id=<%=forum_id%>" target="_blank" class="novel-award-aside-to-fans">\u7C89\u4E1D\u699C ></a>     </div>     <div class="novel-award-aside-info clearfix">         <div class="novel-award-aside-info-cover" style="background-image: url(<%=cover_pic %>)" ></div>         <p class="novel-award-aside-name">             <%=novel_name %>         </p>         <p class="novel-award-aside-info">             <span class="novel-award-aside-info-title">\u5F53\u524D\u7968\u6570\uFF1A</span><%=month_ticket %>  <br />             <span class="novel-award-aside-info-title">\u4F5C\u8005\uFF1A</span><%=author_name %><br />             <span class="novel-award-aside-info-title">\u5206\u7C7B\uFF1A</span><%=category_name %>         </p>     </div>     <button class="btn-encourage btn-middle novel-award-aside-btn" >\u7ED9\u672C\u5427\u6295\u7968</button> </div> ')(t)),t.editable>0&&n.$asideAwardDom.on("click",".novel-award-aside-edit",function(){n.buildBazhuEditDialog()}));var i=e.rank_list;n.$rootDom.find(".j-novel-rank-area").html(_.template(' <table class="novel-rank-top-nav">     <tr class="clearfix">      <%      for(var i = 0; i < data.length; i++) {      %>         <td <%=(i === 0 ? \'class="active"\' : \'\')%> data-type="<%=i %>"><a><%=data[i].class_name %></a></td>         <%      }         %>     </tr> </table> <% for(var i = 0; i < data.length; i++) { %> <ul class="novel-rank-list j-novel-rank-list-<%=i %>" <%=(i === 0 ? \'style="display:block"\' : \'\') %> > </ul> <div class="novel-rank-extra j-novel-rank-extra-<%=i %>" <%=(i !== 0 ? \'style="display:none"\' : \'\') %>>     <p <%=(data[i].ranking < 0 ? \'style="display: none"\' : \'\')%> class="novel-rank-frs-current-ranking">\u672C\u5427\u6392\u884C\uFF1A \u7B2C<span><%=(data[i].ranking + 1) %></span>\u540D</p>  <a class="novel-rank-frs-more" target="_blank" href="/f?ie=utf-8&kw=\u5C0F\u8BF4&novel_tab=ranking&novel_rank_class=<%=data[i].class_id %>">\u67E5\u770B\u5168\u90E8>></a> </div> <% } %>')({data:i}));for(var o=[],s=0;s<i.length;s++)n.showMonthlyTicketRanking(i[s].list,n.$rootDom.find(".j-novel-rank-list-"+s)),i[s].last_month_ranking>=0&&i[s].last_month_ranking<10&&(i[s].index=s,i[s].isFirst=0===o.length,o.push(_.template('<% var lastMonthRankingStringList = [     "\u51A0\u519B",     "\u4E9A\u519B",     "\u5B63\u519B",     "\u7B2C\u56DB\u540D",     "\u7B2C\u4E94\u540D",     "\u7B2C\u516D\u540D",     "\u7B2C\u4E03\u540D",     "\u7B2C\u516B\u540D",     "\u7B2C\u4E5D\u540D",     "\u7B2C\u5341\u540D" ];  %>  <div class="novel-ranking-frs-last j-novel-ranking-frs-last-<%=index %>" <% if (!isFirst) { %>style="display: none"<% } %>>     <p>         <i class="novel-ranking-frs-last-ranking novel-ranking-frs-last-ranking-<%=(last_month_ranking + 1)%>"></i>     </p>     <p>         \u4E0A\u6708<%=class_name%><span class="novel-ranking-frs-last-height-light"><%=lastMonthRankingStringList[last_month_ranking]%></span>     </p> </div>')(i[s])));a.append(o.join(""))})},getMonthlyTicketRanking:function(n,a,e){a=a||function(){},e=e||function(){};var t=this;$.post("/novel/getMonthTicketRankTopN",{count:10,forum_id:t.opt.forumId},function(n){0==n.no?a(n.data):e(n.no,n.error)})},showMonthlyTicketRanking:function(n,a){var e=[],t=1;for(var i in n){var o=n[i];if(!(e.length<10))break;t=void 0===o.ranking?t:o.ranking+1;var s='<span class="novel-ranking-position-number">'+t+"</span>";3>=t&&(s=this.novelIcons.getNovelRankIcon(t)),o=$.extend(o,{isFirst:0===e.length,index:t,rankIcon:s,monthlyTicketHTML:this.novelIcons.getMonthlyTicketIcon()+o.month_ticket});var l=_.template('<% var trendList = [     [\'keep\', \'-\'],     [\'up\', \'&uarr;\'],     [\'down\', \'&darr;\'], ]; %> <li class="novel-ranking-item <%=(item.isFirst ? \'active\' : \'\') %> clearfix" data-ranking="<%=item.index%>">     <div class="novel-ranking-position">         <%=item.rankIcon %>     </div>     <a target="_blank" href="/f?kw=<%=encodeURIComponent(item.forum_name) %>"><div class="novel-ranking-item-cover" style="background-image: url(<%=item.cover_pic %>)" alt="<%=item.novel_name %>" ></div></a>     <p class="novel-ranking-item-info-fold">         <span class="novel-monthly-ticket"><%=item.monthlyTicketHTML %></span>     </p>     <p class="novel-ranking-item-name <%=(item.isTop ? \'novel-ranking-item-top-3\' : \'\') %>">         <a target="_blank" href="/f?kw=<%=encodeURIComponent(item.forum_name) %>">             <span class="novel-ranking-item-status-<%=trendList[item.trend][0]%>"><%=trendList[item.trend][1]%></span> <%=item.novel_name %>         </a>     </p>     <p class="novel-ranking-item-info">         <span class="novel-ranking-item-info-title">\u4F5C\u8005\uFF1A</span><%=item.author_name %> <br />         <span class="novel-ranking-item-info-title">\u5206\u7C7B\uFF1A</span><%=item.category_name %> <br />         <span class="novel-ranking-item-info-title">\u6536\u5230\uFF1A</span><span class="novel-monthly-ticket"><%=item.monthlyTicketHTML %></span>     </p> </li> ')({item:o});e.push(l),t++}"undefined"!=typeof a.jquery&&a.html(e.join(""))},buildBazhuEditDialog:function(){this.bazhuEditDialog&&"function"==typeof this.bazhuEditDialog.close&&this.bazhuEditDialog.close(),this.bazhuEditDialog=new $.dialog({title:"\u4FEE\u6539\u4F5C\u54C1\u8BBE\u7F6E",html:' <div class="novel-aside-bazhu-container">     <p class="novel-aside-bazhu-alert">\u6BCF\u4E2A\u6708\u4EC5\u53EF\u4FEE\u6539\u4E00\u6B21\u8BBE\u7F6E\uFF0C\u8BF7\u8BA4\u771F\u586B\u5199</p>     <div class="novel-aside-bazhu-item">         <div class="novel-aside-bazhu-item-name">\u4F5C\u54C1\u5C01\u9762\uFF1A</div>         <button class="novel-aside-bazhu-cover-upload">\u4E0A\u4F20</button>         <span class="novel-aside-bazhu-cover-info"></span>     </div>     <div class="novel-aside-bazhu-item">         <div class="novel-aside-bazhu-item-name">\u4F5C\u8005\u540D\u5B57\uFF1A</div>         <input type="text" class="form-control j-novel-aside-bazhu-author-name" />     </div>     <div class="novel-aside-bazhu-item">         <div class="novel-aside-bazhu-item-name">\u672C\u4E66\u7B80\u4ECB\uFF1A</div>         <textarea class="form-control j-novel-aside-bazhu-novel-desc" style="width: 320px; height: 100px;"></textarea>     </div>     <p style="text-align: center; margin-top: 10px;"><button class="novel-aside-bazhu-save-btn">\u4FDD\u5B58</button></p> </div>',width:500,height:280}),this.setDialogUploaderAndBindSubmitEvent()},setDialogUploaderAndBindSubmitEvent:function(){var n={tbs:this.opt.tbs||PageData.tbs},a=this,e=this.bazhuEditDialog.element.find(".novel-aside-bazhu-cover-info"),t=this.requireInstance("common/widget/image_uploader_manager",{container:this.bazhuEditDialog.element.find(".novel-aside-bazhu-cover-upload"),queueLen:1});t.bind("onFileSelected",t.startUpload.bind(t)),t.bind("onStartUpload",function(){}),t.bind("onComplete",function(a,t){var i=t.imageList[0],o=i.response.info;n.cover_pic="http://imgsrc.baidu.com/forum/pic/item/"+o.pic_id_encode+".jpg",e.text(i.name)}),this.bazhuEditDialog.element.on("click",".novel-aside-bazhu-save-btn",function(){n.forum_id=a.opt.forumId,n.author_name=a.bazhuEditDialog.element.find(".j-novel-aside-bazhu-author-name").val(),n.novel_intro=a.bazhuEditDialog.element.find(".j-novel-aside-bazhu-novel-desc").val(),a.sendBazhuNovelForm(n)})},sendBazhuNovelForm:function(n){var a=this;$.post("/novel/setNovelForum",n,function(n){0===n.no?(new $.dialog({html:"\u63D0\u4EA4\u6210\u529F~"}),setTimeout(function(){location.reload()},3e3)):new $.dialog({html:"\u51FA\u73B0\u9519\u8BEF\uFF1A"+n.error}),a.bazhuEditDialog.close(),a.bazhuEditDialog=null})},postTrack:function(){var n=void 0===arguments[0]?"":arguments[0],a=void 0===arguments[1]?"\u6708\u7968\u6392\u884C\u524D\u5341":arguments[1],e=void 0===arguments[2]?"\u5C0F\u8BF4\u5427\u7EDF\u8BA1":arguments[2];$.stats.track(a,e,"","",{object_name:n})}}});_.Module.define({path:"common/widget/AsideFloatBar",requires:["common/widget/tbshare"],sub:{initial:function(t){"undefined"!=typeof PDC&&PDC.mark("c_afbavi"),this.options=t,this.$root=$('<ul class="tbui_aside_float_bar"></ul>');for(var e=0,i=t.buttons.length;i>e;e++){var a=t.buttons[e];this.addButton(a)}this.$root.appendTo("body");var o=this;o.relocate(),$(window).resize(function(){o.relocate()});var r=PageData.product;if("pb"==r&&this.$root.find(".tbui_fbar_favor").on("mouseenter",function(){$.stats.track("PB\u60AC\u6D6E\u7231\u901B\u7684\u5427","\u8D34\u5427PC\u9875\u9762\u4F18\u5316","pb","click"),$(this).find(".tbui_aside_favor_list a").one("click",function(){$.stats.track("PB\u60AC\u6D6E\u7231\u901B\u5427\u5C55\u5F00\u5427","\u8D34\u5427PC\u9875\u9762\u4F18\u5316","pb","click")})}),"frs"==r||"pb"==r||"pb_bright"==r){if("frs"==r)var n=["\u53D1\u5E16","\u5237\u65B0","\u5206\u4EAB","\u7231\u901B\u7684\u8D34\u5427","\u63A8\u8350\u6E38\u620F","\u5B9E\u9A8C\u5BA4","\u8FD4\u56DE\u9876\u90E8"];else var n=["\u9B54\u6CD5\u9053\u5177","\u795E\u6765\u4E00\u53E5","\u5206\u4EAB","\u7231\u901B\u7684\u8D34\u5427","\u5B9E\u9A8C\u5BA4","\u53EC\u5524\u5EA6\u5A18","\u8FD4\u56DE\u9876\u90E8"];r="pb"==r||"pb_bright"==r?"pb":"frs",this.$root.delegate(".tbui_aside_fbar_button","mouseenter",function(t){var e=$(t.target),i=e.parent().index();return 6===i?!1:($.stats.track(n[i]+"\u70B9\u51FB\u91CF","FRS/PB\u53F3\u4FA7\u5DE5\u5177\u680F\u7EDF\u8BA1",r,"click"),void 0)})}},addButton:function(t){var e=$($.tb.format('<li class="tbui_aside_fbar_button tbui_fbar_#{btnName}"><a href="#"></a></li>',{btnName:t})),i=this["_"+t];i&&i.call(this,e)&&this.$root.append(e);var a=this;$("body").click(function(){a.hidePanel()})},hidePanel:function(){$("#bdshare_tb_l").hide(),$(".tbui_aside_smiley").hide(),$("#tbui_aside_favor_list").hide(),$(".tbui_aside_props_list").hide()},relocate:function(){$(window).width()<1105?this.$root.addClass("tbui_afb_compact"):this.$root.removeClass("tbui_afb_compact")},_square:function(t){return t.children().tbattr("href","/f?kw=%D0%E3"),t.children().tbattr("target","_blank"),!0},_top:function(t){var e=$(window);0==e.scrollTop()&&t.css("visibility","hidden"),t.click(function(t){function i(){o=Math.floor(o/2),window.scrollTo(0,o),o>2?a=setTimeout(i,40):(window.scrollTo(0,0),clearTimeout(a))}t.preventDefault();var a=null,o=e.scrollTop();$.browser.msie?window.scrollTo(0,0):i()});var i,a=!1;return e.bind("scroll",function(){i&&clearTimeout(i),i=setTimeout(function(){e.scrollTop()>0?0==a&&(t.css("visibility","visible"),a=!0):a&&(t.css("visibility","hidden"),a=!1)},500)}),!0},_refresh:function(t){return t.click(function(){return $.tb.location.reload(),!1}),!0},_post:function(t){var e=this;return t.children().tbattr("href","#sub"),t.click(function(t){t.preventDefault(),t.stopPropagation(),setTimeout(function(){e.fire("wanna_post")},50)}),!0},_share:function(t){return this.requireInstance("common/widget/tbshare/tbshare_popup",[{$container:t.find("a")}]),!0},_radar:function(t){var e=this;return t.find("a").append('<img src="http://tb2.bdstatic.com/tb/static-common/img/toolbar/radar_51d309d.gif" class="tbui_radar_img" />'),t.find("a").tbattr({href:$.tb.unescapeHTML(e.options.radarData&&e.options.radarData.link),target:"_blank"}),t.on("mousedown","a",function(){$.stats.track("radar","radar_banner")}),$.browser.msie&&7==$.browser.version&&t.css("marginBottom","-4px"),$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px")),!0},_tsukkomi:function(t){var e=this;$.browser.msie&&7==$.browser.version&&t.css("marginBottom","-4px"),$.browser.msie&&6==$.browser.version&&t.css("marginBottom","-3px").append("<div></div>");var i=$('<div class="tbui_aside_smiley"></div>');return t.append(i),_.Module.use("common/component/InterestSmiley",{container:i,smileClass:"t_smile_bg",type:"toolbar",scrollCss:{padding:"9px 0px 0px 0px"},scrollBarHide:function(){i.width(296)},scrollBarShow:function(){i.width(306)},dataPostor:e.options.dataPostor},function(a){e.interestSmile=a,e.interestSmile.generic(),t.on("mouseenter",function(){e.hidePanel()}),t.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){i.fadeIn(),e.interestSmile.scrollPanel&&e.interestSmile.scrollPanel.setHeight(260)},mouseleave:function(){i.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()})}),!0},_favor:function(t){var e="http://tb2.bdstatic.com/tb/static-common/widget/aside_float_bar/images/loading2_a8a93d0.gif";if(0==PageData.user.is_login)return!1;var i=PageData.user.id,a="/p/getLikeForum",o=[];$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px"));var r=$('<ul class="tbui_aside_favor_list clearfix" id="tbui_aside_favor_list"></ul>'),n='<li class="j_favor_loading"><div class="favor_loading"><img src="'+e+'">\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E\u3002\u3002\u3002</div></li>';r.append(n),$.ajax({url:a,dataType:"json",type:"GET",data:{uid:i}}).done(function(t){if(t&&0===t.errno){if(t.data&&t.data.info&&(o=t.data.info),0==o.length)return!1;if(o.length>0){var e,i=o,a=!1;i.length<=8?e=i.length:(e=7,a=!0),r.find(".j_favor_loading").hide();for(var n=0;e>n;n++){var s={kw:encodeURIComponent(i[n].forum_name),forumName:$.tb.subByte(i[n].forum_name,12)};r.append($.tb.format('<li><a href="http://tieba.baidu.com/f?ie=utf-8&kw=#{kw}" target="_blank" class="ui_text_summary">#{forumName}</a></li>',s))}a&&r.append('<li><a target="_blank" class="ui_text_desc" href="http://tieba.baidu.com/home/forum?id='+PageData.user.portrait+'" class="aside_float_favforum_more">\u66F4\u591A&gt;&gt;</a></li>')}}}),r.hide().appendTo(t);var s=this;return t.on("mouseenter",function(){s.hidePanel()}),t.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){r.fadeIn()},mouseleave:function(){r.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()}),!0},_lab:function(t){t.children().tbattr("target","_blank").tbattr("href","http://tieba.baidu.com/idea/index");var e=$("<div class='tbui_aside_lab_tip'></div>");if(t.append(e),$.tb.Storage.remove("close_cm_bubble"),"1"!=$.tb.Storage.get("close_mt_bubble")&&+new Date<+new Date(2015,6,19)){var i={content:"<span class='ui_text_emphasize'>\u5FEB\u6377\u952E\u8D34\u5427</span>\u4E0A\u7EBF\u5566\uFF0C\u5FEB\u6765\u4F53\u9A8C\u5427~",arrow_dir:"right",bubble_css:{top:0,right:50,width:150},wrap:e,closeBtn:!0},a=new UiBubbleTipBase(i);a.bind("onclose",function(){$.tb.Storage.set("close_mt_bubble","1",(new Date).getTime()+6048e5),a.closeBubble()}),a.j_bubble.show()}return!0},_home:function(t){return t.children().tbattr("href","http://www.baidu.com?tn=SE_hldp03460_124vf6k4"),t.children().addClass("j_aside_float_bar_go_home"),t.children().tbattr("target","_blank"),!0},_props:function(t){var e=this,e=this;return t.on("mouseenter",function(){e.hidePanel()}),_.Module.use("props/widget/MagicProps",{wrap:t,propsData:e.options.propsData},function(e){e.visible?$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px")):t.css("display","none")}),!0}}});_.Module.define({path:"props/widget/MagicProps",requires:["props/widget/Residual"],sub:{initial:function(t){this.$wrap=t.wrap,this.dataObj=t.propsData,this.visible=!1,this.initOptions(),this.loadComponent(),this.buildProps()},initOptions:function(){this.propsOptions={1070001:{key:"worship",name:"\u9B54\u62DC",flashOptions:{width:320,height:390,marginLeft:0,marginTop:0}},1070002:{key:"egg",name:"\u9B54\u86CB",flashOptions:{width:900,height:600,marginLeft:384,marginTop:70}}},this.mallurl="/tbmall/propslist?category=107",this.poolSize=5;var t=window.navigator.userAgent.match(/chrome/i);this.page=t?$(document.body):$(document.documentElement)},loadComponent:function(){this.residual=this.use("props/widget/Residual")},buildProps:function(){this.initPropsData(),this.propsList.length>0&&(this.visible=!0,this.initPropsUI(),this.bindPropsEvents())},initPropsData:function(){for(var t=this.dataObj.owner||{},a=null,i=null,s=[],e={},o=["1070001","1070002"],r=0;r<o.length;r++)i=o[r],a={id:i,count:t[i]&&t[i].left_num||0},$.extend(a,this.propsOptions[i]),s.push(a),e[i]=a;this.propsList=s,this.propsMap=e},initPropsUI:function(){for(var t=this,a=$('<ul class="tbui_aside_props_list clearfix" id="tbui_aside_props_list"></ul>'),i=new Array,s=null,e=0;e<t.propsList.length;e++)s=t.propsList[e],i.push('<li class="props_item props_item_'+s.id+'">'),s.count>0?i.push('<a class="j_props_btn props_item_btn" href="#" data-id="'+s.id+'"><img src="http://tb2.bdstatic.com/tb/static-props/img/props/'+s.key+'.png"/></a>'):i.push('<a class="props_item_btn" target="_blank" href="'+t.mallurl+'" data-id="'+s.id+'"><img src="http://tb2.bdstatic.com/tb/static-props/img/props/'+s.key+'.png"/><span class="props_buy_icon"></span></a>'),i.push('<p class="props_item_title">'),i.push("<span>"+s.name+"</span>"),s.count>0&&(i.push('<span class="props_item_sign">'+String.fromCharCode(215)+"</span>"),i.push('<span class="props_item_num">'+s.count+"</span>")),i.push("</p>"),i.push("</li>");a.html(i.join("")),a.hide().appendTo(t.$wrap),t.$propsList=a},bindPropsEvents:function(){var t=this;t.$wrap.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){t.$propsList.fadeIn()},mouseleave:function(){t.$propsList.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()}),t.$propsList.delegate(".j_props_btn","click",function(){var a=$(this).data("id"),i=t.propsMap[a];return t.propsObj=i,i.count>0&&("pb"==PageData.product?t.buildPostArea():"ihome"==PageData.product&&t.buildIhomeArea(),t.buildMask(),t.initFlashCallbacks()),!1})},buildIhomeArea:function(){var t={jdom:$("div.userinfo_wrap"),userId:this.dataObj.home_user_id,propsData:this.dataObj.home_user_props,propsType:0},a=$("#headinfo_wrap"),i=a.offset().left,s=a.offset().top,e=i+a.width(),o={marginLeft:i,marginRight:e,marginTop:s,marginBottom:$("body").height()-28};$.extend(t,o),this.limitArea=o,this.areaList=[t]},buildPostArea:function(){for(var t=$("#j_p_postlist"),a=t.find(".j_l_post"),i=null,s=null,e=[],o=t.offset().left,r=t.offset().top,p=o+t.width(),n=0;n<a.length;n++)i=$(a[n]),s=i.getData(),this.doPostItem(i,s,o,p,e);var l={marginLeft:o,marginRight:p,marginTop:r,marginBottom:r+t.height()};this.limitArea=l,this.areaList=e},doPostItem:function(t,a,i,s,e){var o=null,r=null,p=null,n=t.offset().top,l=n+t.height(),h={userId:a.author.user_id,postId:a.content.post_id,propsData:a.content.props,marginTop:n,marginBottom:l};r={},o=t.find(".d_author"),r.jdom=o,r.marginRight=i+130,r.marginLeft=i,$.extend(r,h),e.push(r),p={},o=t.find(".d_post_content_main"),p.jdom=o,p.marginRight=s,p.marginLeft=i+130,$.extend(p,h),e.push(p)},buildMask:function(){this.flashPool=[],this.currScrollTop=0,this.currAreaObj=null,this.initMask(),this.setMaskPosition(0,0,0,0),this.bindMaskEvents()},initMask:function(){var t=$('<div class="mask_layer mask_top"></div>'),a=$('<div class="mask_layer mask_right"></div>'),i=$('<div class="mask_layer mask_bottom"></div>'),s=$('<div class="mask_layer mask_left"></div>'),e=$('<div class="mask_layer light_area"></div>'),o=$('<div id="mask_wrap" class="mask_wrap mouse_'+this.propsObj.key+'"></div>');o.append(t).append(a).append(i).append(s).append(e).css({"z-index":$.getzIndex()}),$("body").append(o),this.$maskWrap=o,this.maskMap={topMask:t,rightMask:a,bottomMask:i,leftMask:s,lightArea:e}},setMaskPosition:function(t,a,i,s){var e=this.maskMap;e.topMask.css({height:a}),e.rightMask.css({left:t+i,top:a,width:$("body").width()-(t+i),height:s}),e.bottomMask.css({top:a+s,height:$("body").height()-(a+s)}),e.leftMask.css({top:a,width:t,height:s}),e.lightArea.css({left:t,top:a,width:i,height:s})},bindMaskEvents:function(){var t=this;$("body").bind("contextmenu",function(){return!1}),$(document).bind("keydown",function(a){if(27==a.which&&null!=t.$maskWrap){if(t.disabledMove)return!1;t.clear()}}),t.$maskWrap.mousedown(function(a){if(3==a.which){if(t.disabledMove)return!1;t.clear()}return!1});var a=50,i=$("body").width()-a,s=0;t.$maskWrap.mousemove(function(a){if(t.$bulletLayer||(t.$bulletLayer=t.buildBulletLayer(),t.$maskWrap.append(t.$bulletLayer)),s=a.pageX,s>i&&(s=i),t.$bulletLayer.css({left:s,top:a.pageY}),t.disabledMove)return!1;var e=null,o=t.limitArea;if(t.isInArea=a.pageX>=o.marginLeft&&a.pageX<=o.marginRight&&a.pageY>=o.marginTop&&a.pageY<=o.marginBottom?!0:!1,t.isInArea)for(var r=0;r<t.areaList.length;r++)e=t.areaList[r],a.pageX>=e.marginLeft&&a.pageX<=e.marginRight&&a.pageY>=e.marginTop&&a.pageY<=e.marginBottom&&(t.setMaskPosition(e.marginLeft,e.marginTop,e.marginRight-e.marginLeft,e.marginBottom-e.marginTop),e.propsType=r%2,t.areaObj=e);else t.setMaskPosition(0,0,0,0)})},buildBulletLayer:function(){var t=this,a=$('<div class="bullet_layer"><span class="bullet_layer_tip">\u53F3\u952E\u53D6\u6D88</span></div>');return a.click(function(){t.isInArea?t.propsObj.count>0?t.flashPool.length<=t.poolSize&&(t.updatePosition(),t.post()):t.showTomallDialog():t.clear()}),a},clear:function(){this.clearPool(),this.$maskWrap.remove(),this.$maskWrap=null,this.$bulletLayer=null,setTimeout(function(){$("body").unbind("contextmenu")},300)},post:function(){var t=this,a="/tbmall/post/useAppraiseProps",i={props_id:t.propsObj.id,target_user_id:t.areaObj.userId||"",type:t.areaObj.propsType,post_id:t.areaObj.postId||"",tbs:PageData.tbs};$.tb.post(a,i,function(a){a&&0==a.no&&t.updatePage()})},updatePage:function(){var t=this.propsObj.id,a=".props_item_"+t;this.updatePropsBtnNum(t,a),("ihome"==PageData.product||"1"==this.areaObj.propsType)&&this.updatePostAreaNum(t,a)},updatePropsBtnNum:function(t,a){var i=$("#tbui_aside_props_list "+a),s=this.propsObj.count-1;s=s>0?s:0,this.propsObj.count=s,s>0?i.find(".props_item_num").text(s):(i.find(".props_item_btn").removeClass("j_props_btn").tbattr("target","_blank").tbattr("href",this.mallurl).append('<span class="props_buy_icon"></span>'),i.find(".props_item_sign").remove(),i.find(".props_item_num").remove())},updatePostAreaNum:function(t,a){var i=this.areaObj.propsData||{};i[t]||(this.areaObj.propsData={},this.areaObj.propsData[t]={num:0});var s=this.areaObj.propsData[t].num+1;s=s>0?s:0,this.areaObj.propsData[t].num=s;var e=this.areaObj.jdom.find("ul.props_appraise_wrap"),o=e.find(a);o[0]?o.find(".props_item_num").text(s):(htmlArr=[],htmlArr.push('<li class="props_item props_item_split"><span class="userinfo_split"></span></li>'),htmlArr.push('<li class="props_item props_item_'+t+'">'),htmlArr.push('<a href="#" data-postid="'+(this.areaObj.postId||"")+'" data-id="'+t+'" class="props_item_icon"></a>'),htmlArr.push('<span class="props_item_plus">'+String.fromCharCode(215)+"</span>"),htmlArr.push('<span class="props_item_num">'+s+"</span></li>"),"1070001"==t?e.prepend($(htmlArr.join(""))):"1070002"==t&&e.append($(htmlArr.join(""))))},updatePosition:function(){var t=this,a=this.propsOptions[this.propsObj.id].flashOptions,i=($(window).height()-a.height)/2;i=150>i?150:i;var s=this.areaObj.jdom.offset().top-i;this.disabledMove=!0;var e=$(window).scrollTop();0==e||e!=this.currScrollTop||this.currAreaObj&&this.currAreaObj.marginTop!=this.areaObj.marginTop?(this.currAreaObj=this.areaObj,this.currScrollTop=e,t.page.animate({scrollTop:s},300,"swing",function(){t.buildFlash(s)})):t.buildFlash(s)},buildFlash:function(t){var a=this,i=0,s=0,e=$('<div class="props_flash_wrap"></div>'),o=this.propsOptions[this.propsObj.id].flashOptions,r=($(window).width()-o.width)/2,p=t+o.marginTop;r=r>0?r:0,p=p>0?p:0,"0"==a.areaObj.propsType&&"1070002"==a.propsObj.id&&("ihome"==PageData.product?(i=100,s=-15):(i=60,s=-20),r=r-(r+o.marginLeft-a.areaObj.jdom.offset().left)+i,p+=s),e.css({width:o.width,height:o.height,left:r,top:p,"z-index":$.getzIndex()});{var n="/tb/static-props/swf/"+this.propsObj.key+".swf?t=140107";new $.swf(n,{container:e,width:o.width,height:o.height,params:{wmode:"transparent"}})}a.flashPool.push(e),a.$maskWrap.append(e),a.topzIndex=$.getzIndex(),a.$bulletLayer.css({"z-index":a.topzIndex})},buildPlusOne:function(){var t=this,a="plusone_"+this.propsObj.key;$.browser.msie&&6==$.browser.version&&(a+="_png8"),a="/tb/static-props/img/"+a+".png";var i=$('<div class="props_plusone"><img src="'+a+'"/></div>'),s=0,e=0;"ihome"==PageData.product?(s=t.areaObj.marginLeft+70,e=t.areaObj.marginTop+300):(s=t.areaObj.marginLeft+(t.areaObj.marginRight-t.areaObj.marginLeft)/2-18,e=t.areaObj.marginTop+100),i.css({left:s,top:e,"z-index":t.topzIndex+1}),t.$maskWrap.append(i),i.animate({top:"-=100px",opacity:.8},800,"swing",function(){i.remove()})},clearPool:function(){for(var t=this,a=t.flashPool,i=null,s=0;s<a.length;s++)i=a.shift(),i.remove();t.disabledMove=!1},initFlashCallbacks:function(){var t=this,a={},i=null;a.finishPlay=function(){if(t.flashPool.length>0){t.buildPlusOne();var a=t.flashPool.shift();a.remove(),t.flashPool.length<=0&&(t.disabledMove=!1,"0"==t.areaObj.propsType&&("ihome"==PageData.product?i=t.areaObj.jdom.find(".userinfo_left"):"pb"==PageData.product&&(i=t.areaObj.jdom.find(".icon_relative")),t.residual.showUI({wrap:i,key:t.propsObj.key})))}},window.MagicProps=a},showTomallDialog:function(){var t=this,a=new $.dialog({title:"\u63D0\u793A",html:'<div class="props_buy_dialog"><p class="buy_dialog_content">\u4F60\u76EE\u524D\u6CA1\u6709\u53EF\u7528\u7684\u9053\u5177\u4E86\uFF0C\u5FEB\u53BB\u5546\u57CE\u8D2D\u4E70\u5427</p><a class="buy_dialog_link" target="_blank" href="'+t.mallurl+'">\u53BB\u8D2D\u4E70>></a><div>',width:400,height:80});a.element.find(".buy_dialog_link").on("click",function(){t.clear(),setTimeout(function(){t.showBuyDialog(t.mallurl)},200)})},showBuyDialog:function(t){var a='<p class="buy_txt">\u9053\u5177\u8D2D\u4E70\u6210\u529F\u540E\u5373\u53EF\u4F7F\u7528\uFF01</p><div class="buy_dialog_btns"><a href="#" class="ui_btn ui_btn_m btn_success"><span><em>\u8D2D\u4E70\u6210\u529F</em></span></a><a href="#{href}" target="_blank"  class="ui_btn ui_btn_sub_m btn_failure"><span><em>\u8D2D\u4E70\u5931\u8D25\uFF0C\u91CD\u65B0\u8D2D\u4E70</em></span></a></div>',i=new $.dialog({title:"\u63D0\u793A",html:$.tb.format(a,{href:$.tb.unescapeHTML(t)}),width:400,height:80});i.bind("onclose",function(){$.tb.location.reload()}),i.element.find(".btn_success").on("click",function(t){t.preventDefault(),$.tb.location.reload()})}}});